<html>
    <head>
        <title>Terminoteca admin 1</title>
        <meta charset="utf-8"> 
        <!--    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/> -->
        <meta name="description" content="Administration of terminoteca">
        <meta name="author" content="V√≠ctor Rodr√≠guez Doncel">
        <link rel="icon" type="image/png" href="/favicon.png">        
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
        <link rel="stylesheet" href="/terminoteca.css">
        <script type="text/javascript" src="/terminoteca.js"></script>      
        <style>
            .tablavictor
            {
                border:1px solid;
                table-layout: fixed;
                width: 430px;
                -moz-border-radius:5px;
                -webkit-border-radius:5px;
                border-radius:5px;                

                -moz-box-shadow: 0 1px 2px #d1d1d1;
                -webkit-box-shadow: 0 1px 2px #d1d1d1;
                box-shadow: 0 1px 2px #d1d1d1;                

                margin-left: auto;
                margin-right: auto;                
            }
            .tablavictor td {
                border-bottom-style: dotted;
            }
            .tablavictor th
            {
                text-align:left;font-size:small;border-bottom-style: solid;border-bottom: 1px solid;
            }
        </style>
    </head>
    <body onload="inicio()">


        <!-- No bootstrap. Organization as in https://matthewjamestaylor.com/bottom-footer -->
        <div id="vcontainer">
            <div id="vheader">
                <div w3-include-html="/header.html"></div>
                <center><h4 style="color:brown;">Administration</h4></center>
                <div style="position:absolute !important; top: 5px; right: 5px; width: 105px; text-align:right;">
                    <a href="/swagger-ui.html"><img src="/images/openapi.png" width="100"></a>
                </div>
            </div>
            <div id="vbody">

                <table id="idschemes" class="tablavictor">

                    <colgroup>
                        <col width=110px>
                        <col width=240px>
                        <col width=80px>
                    </colgroup>         
                    <thead >
                        <tr ><th>Action</th><th>Concept scheme</th><th>#concepts</th></tr></thead><tbody id="idtbody">
                    </tbody>

                </table>
                <!--                <div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event);">
                                    <p>Drag one or more files to this Drop Zone ...</p>
                                </div>
                -->

                <div id="snackbar">I don't understand this format.</div>
            </div>
            <div id="vfooter">
                <div w3-include-html="/footer.html"></div>
            </div>
        </div>


        <script>
            //To make the footer and header work
            includeHTML();
            
            //To laod the table with the existing ConceptSchemes.
            async function loadschemes()
            {
                var table = document.getElementById("idschemes");
                var tbody = document.getElementById("idtbody");
                //Ge get the list of schemes.
                const response = await fetch('/scheme/');
                const jschemes = await response.json();
                console.log(jschemes);

                //delete existing rows
                tbody.innerHTML = "";

                for (var scheme in jschemes)
                {
                    var conceptscheme = jschemes[scheme];
                    var tr = tbody.insertRow(-1);
                    var tabCell0 = tr.insertCell(-1);
                    var buttons = '<a style="text-decoration:none;" href="javascript:void(0);" onclick="deleteScheme(\'' + conceptscheme + '\');"><img src="/images/delete.png" width=20px></a>'; //‚ùå
                    buttons+='<a style="text-decoration:none;" href="javascript:void(0);" onclick="downloadScheme(\'' + conceptscheme + '\');"><img src="/images/download.png" width=20px></a>';
                    buttons+='<a style="text-decoration:none;" href="javascript:void(0);" onclick="seeScheme(\'' + conceptscheme + '\');"><img src="/images/eye.png" width=20px></a>';
                    buttons+='<a style="text-decoration:none; title="Rename the conceptscheme" href="javascript:void(0);" onclick="renameScheme(\'' + conceptscheme + '\');"><img src="/images/rename.png" width=16px></a>';
                    
                    tabCell0.innerHTML = buttons;

                    var tabCell1 = tr.insertCell(-1);
                    tabCell1.innerHTML = conceptscheme;
                    var tabCell2 = tr.insertCell(-1);
                    //We get details on every scheme
                    const response2 = await fetch('/scheme/' + conceptscheme);
                    const jresponse2 = await response2.json();
                    if (jresponse2.numElements === undefined)
                        jresponse2.numElements="0";
                    tabCell2.innerHTML = jresponse2.numElements;
                    console.log(jresponse2);
                }
                var tr = tbody.insertRow(-1);
                var c1 = tr.insertCell(-1);
                var c2 = tr.insertCell(-1);
                var c3 = tr.insertCell(-1);
                c2.innerHTML = '<div id="drop_zone" ondrop="dropHandler(event);" ondragover="dragOverHandler(event)";><img src="/images/drop.png" height=24 style="float: right;margin-top:6px;margin-right:30px;"/><p style="margin-left:20px;margin-top:10px;">drop here your SKOS</p> </div>';
                c3.innerHTML = '<div id="idloader1" class="loader" style="display:inline-block;visibility:hidden;"></div>';

/*                var aftertable = document.createElement("div");
                c1.innerHTML = '<a style="text-decoration:none;" href="javascript:void(0);" onclick="uploadScheme();">‚ûï</a>';//                üì§
                table.appendChild(aftertable);*/
            }
            
            async function renameScheme(conceptscheme)
            {
                var newid = prompt("Enter a new name for the concept scheme", "");
                console.log(newid);
                var url = '/scheme/' + conceptscheme+'/rename?newid=' + newid;
                const response = await fetch(url, {method: 'GET'});
                const jschemes = await response.json();
                location.reload();
            }
            
            function seeScheme(conceptscheme)
            {
                console.log("showing " + conceptscheme);
                window.location.href = '/?schemeid='+conceptscheme;
            }
            function downloadScheme(conceptscheme)
            {
                console.log("showing " + conceptscheme);
                window.location.href = '/scheme/'+conceptscheme+"/bulk";
            }
            
            async function deleteScheme(conceptscheme)
            {
                console.log("deleting " + conceptscheme);
                const response = await fetch('/scheme/' + conceptscheme, {method: 'DELETE'});
                const jschemes = await response.json();
                console.log(jschemes);
                loadschemes();

            }

            function inicio()
            {
                console.log("Welcome!");
                loadschemes();

                const queryString = window.location.search;
                const urlParams = new URLSearchParams(queryString);
                if (urlParams.has('searchbox'))
                {
                    const cadena = urlParams.get('searchbox');
                    console.log("Searching " + cadena)
                    fsearch(cadena);
                    //        const response = await fetch('/status');
                    //        const estatus = await response.json();    
                    //        document.getElementById("idcompanies").innerHTML = emovies;
                    //        console.log(emovies);
                }
            }



            function festatus() {
                console.log("Checking status");
                try {
                    var http = new XMLHttpRequest();
                    http.open("GET", '/api/status', true); //true
                    http.send();
                    http.onload = function () {
                        var estatus = http.responseText;
                        console.log(estatus);
                    }
                } catch (e)
                {

                }
            }
        </script>        
    </body>
</html>